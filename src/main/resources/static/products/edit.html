<!DOCTYPE html>
<html>
<head>
    <title>Edit Product</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<h2>Edit Product</h2>

<form id="productForm">
    <input class="form-control mb-2" id="name" required>

    <textarea class="form-control mb-2"
              id="description"></textarea>

    <input class="form-control mb-2"
           type="number"
           id="price"
           step="0.01"
           required>

    <input class="form-control mb-2"
           type="number"
           id="stock"
           required>

    <!-- ðŸ”¥ MUST be select -->
    <select class="form-select mb-2" id="categoryId" required>
        <option value="">-- Select Category --</option>
    </select>

    <button class="btn btn-success">Update</button>
    <a href="index.html" class="btn btn-secondary">Cancel</a>
</form>

<script>
    const id = new URLSearchParams(window.location.search).get('id');

    // 1ï¸âƒ£ Load categories
    fetch('/categories')
        .then(res => res.json())
        .then(categories => {
            const dropdown = document.getElementById('categoryId');

            categories.forEach(c => {
                dropdown.innerHTML +=
                    `<option value="${c.categoryId}">
                        ${c.categoryTitle}
                     </option>`;
            });

            // 2ï¸âƒ£ Load product after categories
            return fetch('/products/' + id);
        })
        .then(res => res.json())
        .then(p => {
            document.getElementById('name').value = p.name;
            document.getElementById('description').value = p.description;
            document.getElementById('price').value = p.price;
            document.getElementById('stock').value = p.stock;
            document.getElementById('categoryId').value = p.categoryId;
        });

    // 3ï¸âƒ£ Submit update
    document.getElementById('productForm')
        .addEventListener('submit', function (e) {

        e.preventDefault();

        fetch('/products/' + id, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name: document.getElementById('name').value,
                description: document.getElementById('description').value,
                price: document.getElementById('price').value,
                stock: document.getElementById('stock').value,
                categoryId: document.getElementById('categoryId').value
            })
        }).then(() => window.location = 'index.html');
    });
</script>

</body>
</html>
