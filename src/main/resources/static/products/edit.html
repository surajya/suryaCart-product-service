<!DOCTYPE html>
<html>
<head>
  <title>Edit Product</title>
</head>
<body>

<h2>Edit Product</h2>

<form id="editForm">
  <input id="name" placeholder="Name" /><br>
  <input id="price" type="number" placeholder="Price" /><br>
  <input id="stock" type="number" placeholder="Stock" /><br>
  <input id="active" placeholder="Active (true/false)" /><br>
  <input id="description" placeholder="description" /><br>

  <select id="category"></select><br><br>

  <button type="submit">Update</button>
</form>

<script>
const id = new URLSearchParams(window.location.search).get("id");

const nameInput = document.getElementById("name");
const priceInput = document.getElementById("price");
const stockInput = document.getElementById("stock");
const activeInput = document.getElementById("active");
const descriptionInput = document.getElementById("description");
const categorySelect = document.getElementById("category");

// 1️⃣ Load categories first
fetch("/api/categories")
  .then(res => res.json())
  .then(categories => {
    categories.forEach(c => {
      categorySelect.innerHTML += `<option value="${c.categoryId}">${c.categoryTitle}</option>`;
    });

    // 2️⃣ Then load product
    return fetch(`/api/products/${id}`);
  })
  .then(res => res.json())
  .then(p => {
  nameInput.value = p.name;
  priceInput.value = p.price;
  stockInput.value = p.stock;
  activeInput.value = p.active;
  descriptionInput.value = p.description;

  if (p.categoryId) {
    categorySelect.value = p.categoryId;
  } else if (p.category && p.category.categoryId) {
    categorySelect.value = p.category.categoryId;
  }
});


// 3️⃣ Update product
document.getElementById("editForm").addEventListener("submit", e => {
  e.preventDefault();

  fetch(`/api/products/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: nameInput.value,
      price: priceInput.value,
      stock: stockInput.value,
      active: activeInput.value,
      categoryId: categorySelect.value,
      description: descriptionInput.value
    })
  }).then(() => {
    window.location.href = "index.html";
  });
});
</script>

</body>
</html>
